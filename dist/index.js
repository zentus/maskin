"use strict";function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(a,b){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a)){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var _require=require("immutable"),Map=_require.Map,merge=_require.merge,Util={returnTrue:function returnTrue(){return!0},noop:function noop(){},isNumberOrTruthy:function isNumberOrTruthy(a){return"number"==typeof a||a},checkInternals:function checkInternals(a,b){var c=function(a){throw new Error("StateMachine internals have become corrupted. Are you mutating an internal property? Missing internals: ".concat(JSON.stringify(a)))},d=!!(a.__internal__&&a.__internal__.get&&a.__internal__.set);d||c(["__internal__"]);var e=Util.internals.filter(function(c){return c!==b&&!Util.isNumberOrTruthy(a[c])});(0<e.length||!a.__internal__.get("state"))&&c(e)},internals:["setState","resetState","state","__internal__","updateCount","preventedUpdateCount","resetStateCount"],readOnlyOptions:{writable:!1,enumerable:!1,configurable:!0}},Maskin=/*#__PURE__*/function(){function a(){var b=this,c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,a),Object.entries(c).forEach(function(a){var c=_slicedToArray(a,2),d=c[0],e=c[1];Util.internals.includes(d)||(b[d]=e)});var d=c.initialState||{};this.setInternals({state:d,initialState:d,updateCount:0,preventedUpdateCount:0,resetStateCount:0}),this.shouldUpdate=c.shouldUpdate||Util.returnTrue,this.beforeUpdate=c.beforeUpdate||Util.noop,this.afterUpdate=c.afterUpdate||Util.noop,this.updatePrevented=c.updatePrevented||Util.noop,this.setState=this.setState.bind(this),this.resetState=this.resetState.bind(this),this.setInternals=this.setInternals.bind(this),c.afterCreated&&c.afterCreated(this)}return _createClass(a,[{key:"setInternals",value:function setInternals(a){Object.defineProperty(this,"__internal__",_objectSpread({value:Map(_objectSpread({},this.__internal__&&this.__internal__.toObject(),{},a))},Util.readOnlyOptions))}},{key:"resetState",value:function resetState(){Util.checkInternals(this,"resetState");var a=this.__internal__.get("initialState");return this.setInternals({state:a,resetStateCount:this.resetStateCount+1}),a}},{key:"setState",value:function setState(a){Util.checkInternals(this,"setState");var b;if("object"===_typeof(a))b=_objectSpread({},a);else if("function"==typeof a)b=_objectSpread({},a(this.state));else return!1;if(b){var c=_objectSpread({},this.state),d=_objectSpread({},c,{},b),e=this.shouldUpdate(this.state,d);return e?(this.beforeUpdate(this.state,d),this.setInternals({state:d,updateCount:this.updateCount+1}),this.afterUpdate(this.state,c,this.setState)):(this.updatePrevented(this.state,b),this.setInternals({preventedUpdateCount:this.preventedUpdateCount+1})),this.state}}},{key:"updateCount",get:function get(){return this.__internal__.get("updateCount")}},{key:"preventedUpdateCount",get:function get(){return this.__internal__.get("preventedUpdateCount")}},{key:"resetStateCount",get:function get(){return this.__internal__.get("resetStateCount")}},{key:"state",get:function get(){return Util.checkInternals(this,"state"),this.__internal__.get("state")}}]),a}();module.exports=Maskin;
